---
description: クイズ動画を作成（準備→音声待ち→レンダリング→紹介文）
---

# クイズ動画作成

フォルダ内の全ての *qas*.md ファイルから動画を作成し、紹介文を生成します。

## 引数

- `$ARGUMENTS`: トピックフォルダパス（例: `datas/history/grade2/4-1/3nanban_trade`）

**注意**: 実際のファイルは `[フォルダパス]/quiz/` サブフォルダ内にあります。

---

## フェーズ1: フォルダ確認とリネーム

### 1.1 フォルダの存在確認

```bash
ls -la [フォルダパス]/quiz
```

### 1.2 フォルダ名の確認

フォルダ名が数字のみ（例: `3`）の場合、適切な名前への変更を提案:

```
現在のフォルダ名: [現在の名前]

リネームしますか？
推奨形式: [番号][トピック名]（例: 3nanban_trade）

→ 新しい名前を入力、または「そのまま」と入力
```

### 1.3 qas.mdファイルの検索

```bash
ls [フォルダパス]/quiz/*qas*.md
```

**複数ファイルがある場合**: 各ファイルに対して処理を行う。

---

## フェーズ2: 全qas.mdファイルの一覧と確認

### 2.1 ファイル一覧の表示

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
検出されたqas.mdファイル:

1. [ファイル名1].md（[問題数1]問）
2. [ファイル名2].md（[問題数2]問）
...

合計: [N]ファイル、[M]問
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 2.2 ユーザー確認

```
これらのファイルから動画を作成します。よろしいですか？
→ 「OK」または処理するファイル番号を入力（例: 1,2）
```

---

## フェーズ3: 統合qa.mdの作成

### 3.1 全qas.mdファイルの内容を統合

全ての *qas*.md ファイルから問題と答えのみを抽出し、1つのqa.mdに統合。

**qas.mdの構造**:
```
問題1
答え1
補足1

問題2
答え2
補足2
```

↓ 補足行と空行を削除して統合

**qa.mdの構造**（統合版）:
```
問題1
答え1
問題2
答え2
...
問題N
答えN
```

### 3.2 保存

`[フォルダパス]/quiz/qa.md` に保存（単一ファイル）。

---

## フェーズ4: 音声作成の依頼【ここで一時停止】

### 4.1 audiosフォルダの作成

単一のaudiosフォルダを作成:

```bash
mkdir -p [フォルダパス]/quiz/audios
```

### 4.2 トピックIDの決定

フォルダ名をそのまま使用（例: `3nanban_trade`）

### 4.3 音声ファイルリストの出力

qa.mdの各行に対応する音声ファイルを連番で作成。
全qas.mdファイルの内容を通しで番号付け。

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
## 音声ファイル作成依頼

保存先: [フォルダパス]/quiz/audios/

qa.mdの各行 → 対応する音声ファイル

| 行番号 | ファイル名 | 種類 | 読み上げテキスト |
|-------|-----------|------|-----------------|
| 1 | 00-[トピックID].wav | Q1 | [問題1] |
| 2 | 01-[トピックID].wav | A1 | [答え1] |
| 3 | 02-[トピックID].wav | Q2 | [問題2] |
| 4 | 03-[トピックID].wav | A2 | [答え2] |
...（全qas.mdの内容を通しで番号付け）

※ 補足部分の音声は不要（qa.mdには含まれない）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

全ての音声ファイルを配置したら「OK」と入力してください。
```

### 4.4 ユーザーの確認を待つ

**ここで必ず停止し、ユーザーの「OK」を待つ。**

---

## フェーズ5: 各ファイルの処理ループ

以下を各 *qas*.md ファイルに対して繰り返す:

### 5.1 音声ファイル範囲の決定

各qas.mdファイルは、qa.md内の連番に対応する音声ファイルを使用:
- 1番目のqas.md（N問）: 音声 00 〜 (N×2-1)
- 2番目のqas.md（M問）: 音声 (N×2) 〜 (N×2+M×2-1)

例（6問ずつの場合）:
- 03-qas.md: 00-11（Q1-6 + A1-6）
- 04-qas.md: 12-23（Q7-12 + A7-12）

### 5.2 音声長さの取得

```bash
for f in [フォルダパス]/quiz/audios/[開始番号]-*.wav ... [終了番号]-*.wav; do
  duration=$(ffprobe -i "$f" -show_entries format=duration -v quiet -of csv="p=0" 2>/dev/null)
  frames=$(echo "$duration * 30" | bc | cut -d. -f1)
  echo "$(basename "$f"): ${duration}s = ${frames}frames"
done
```

### 5.3 IchimonIttoData.tsx の生成

**改行ルール**: `\n`を使う場合は**必ず11文字以内**（12文字以上は禁止）。

**判断基準**:
1. **9〜11文字**で切りの良い位置がある → `\n`を入れる（推奨）
2. **8文字以下**でしか切れない → `\n`を入れない（自動改行に任せる）
   - 理由: 前半が短すぎると後半が長くなり、3行表示になって見づらい
3. **12文字以上**でしか切れない → `\n`を入れない（自動改行に任せる）

**文字数の数え方**:
- 句読点（、。）、括弧（「」『』（））も**1文字**としてカウント
- 数字・ローマ字は2文字で1文字分としてカウント
- 例: 「1549年に」= 1(0.5)+5(0.5)+4(0.5)+9(0.5)+年(1)+に(1) = 4文字
- 例: 「キリスト教」= 5文字
- 例: 「京都で「かぶきおどり」を」= 京都で(3)+「(1)+かぶきおどり(6)+」(1)+を(1) = **12文字 ← NG**

**例**:
- OK: 「秀吉が土地の面積や\n収穫量を...」= 10文字で改行
- OK: 「朝鮮出兵の際に連行された陶工が伝えた工芸品は？」= \nなし（12文字でしか切れないため）
- NG: 「朝鮮出兵の際に\n連行された...」= 8文字で改行（前半が短すぎ、後半が3行になる）
- NG: 「朝鮮出兵の際に連行された\n陶工が...」= 12文字で改行（12文字以上は禁止）

```typescript
// 保存用ファイル - [ID]-qas.md
// フォルダ: [フォルダパス]
// 生成日: [日付]

export interface IchimonIttoScene {
    id: string;
    question: string;
    answer: string;
    description?: string;
    questionAudio: string;
    questionDuration: number;
    answerAudio: string;
    answerDuration: number;
}

export const ichimonIttoData: IchimonIttoScene[] = [
    {
        id: 'q1',
        question: '[問題1]',
        answer: '[答え1]',
        description: '[補足1]',
        questionAudio: 'audio/explain/[開始番号]-[トピックID].wav',
        questionDuration: [フレーム数],
        answerAudio: 'audio/explain/[開始番号+1]-[トピックID].wav',
        answerDuration: [フレーム数],
    },
    // ...
];
```

保存先: `[フォルダパス]/quiz/[ID]-IchimonIttoData.tsx`

### 5.4 レンダリング

```bash
# 既存の音声ファイルを削除してコピー
rm -rf public/audio/explain/*
cp [フォルダパス]/quiz/audios/*.wav public/audio/explain/

# src/IchimonIttoData.tsx の更新
# → 生成した内容で上書き

# レンダリング実行
npx remotion render src/index.ts IchimonIttoShorts [フォルダパス]/quiz/[ID]-output.mp4

# コピーした音声ファイルを削除（オプション）
rm -f public/audio/explain/*.wav
```

### 5.5 紹介文の生成

**post_youtube.txt**:
```
【タイトル】
[問題数]問全問正解できる？[単元名]｜[学年][教科]一問一答

【説明文】
全問即答できる？🤔

[学年][教科]「[単元名]」の重要ポイントを[問題数]問でチェック！
定期テスト前の確認にぴったりです。

📌 詰まった問題があれば→復習のチャンス
📌 全問スラスラ答えられたら→テスト準備OK

答えは動画で確認 → 一時停止しながらでOK！

【タグ】
中学生,[学年],[教科],一問一答,定期テスト対策,テスト勉強,暗記,ショート動画,受験勉強,[単元キーワード]
```

**post_instagram.txt**:
```
全問即答できる？

[学年][教科]「[単元名]」[問題数]問

[キーワード1]、[キーワード2]、[キーワード3]…
パッと答えられる？

詰まった問題は保存して復習しよう
今のうちに覚えれば本番で自信がつく

#中学生 #[教科] #一問一答 #定期テスト対策 #勉強垢
```

※ Instagramのハッシュタグは5つ以内に制限

保存先:
- `[フォルダパス]/quiz/[ID]-post_youtube.txt`
- `[フォルダパス]/quiz/[ID]-post_instagram.txt`

---

## フェーズ6: 完了報告

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
## 完了

### 共通ファイル
- qa.md（音声作成用・統合版）

### 処理したファイル: [N]件

【[ID1]】
- [ID1]-IchimonIttoData.tsx
- [ID1]-output.mp4
- [ID1]-post_youtube.txt
- [ID1]-post_instagram.txt

【[ID2]】
- [ID2]-IchimonIttoData.tsx
- [ID2]-output.mp4
- [ID2]-post_youtube.txt
- [ID2]-post_instagram.txt

...

### 次のステップ
1. 各output.mp4を確認
2. 紹介文を確認・編集
3. アップロード
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ファイル構造（複数qas.mdの場合）

```
[フォルダパス]/
├── quiz/                   # 一問一答関連
│   ├── 03-qas.md           # 元データ1
│   ├── 04-qas.md           # 元データ2
│   ├── qa.md               # 音声作成用（統合版・全問題を連番）
│   ├── 03-IchimonIttoData.tsx
│   ├── 03-output.mp4
│   ├── 03-post_youtube.txt
│   ├── 03-post_instagram.txt
│   ├── 04-IchimonIttoData.tsx
│   ├── 04-output.mp4
│   ├── 04-post_youtube.txt
│   ├── 04-post_instagram.txt
│   └── audios/             # 単一フォルダ・連番
│       ├── 00-[トピック].wav  # Q1（03-qas.md）
│       ├── 01-[トピック].wav  # A1
│       ├── ...
│       ├── 11-[トピック].wav  # A6（03-qas.md最後）
│       ├── 12-[トピック].wav  # Q7（04-qas.md開始）
│       ├── ...
│       └── 23-[トピック].wav  # A12（04-qas.md最後）
└── story/                  # 脚本・画像（解説動画用）
    ├── script.md
    └── images/
```

---

## 重要なルール

1. **フェーズ4で必ず停止** - 全ファイルの音声準備完了を待つ
2. **各ファイルを順番に処理** - 1ファイルずつレンダリング
3. **IDをファイル名のプレフィックスに使用** - 例: `03-qas.md` → `03-`
4. **紹介文のフォーマットは統一** - テンプレート通りに作成
